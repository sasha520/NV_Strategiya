<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>NV_Strategy</title>
<style>
body{margin:0;background:#1b1b1b;color:white;font-family:Arial;overflow:hidden;}
#ui{position:fixed;top:0;left:0;width:100%;background:#111;padding:8px;display:flex;gap:10px;align-items:center;z-index:10;}
button,input{background:#333;color:white;border:1px solid #666;padding:5px 10px;}
button:hover{background:#555;}
#money,#reserve,#tankReserve{font-weight:bold;margin-left:10px;}
#map-wrapper{position:absolute;top:50px;left:0;right:0;bottom:0;overflow:hidden;}
#map{position:absolute;}
.tile{
position:absolute;
width:90px;
height:90px;
border-radius:8px;
border:2px solid black;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
font-size:11px;
cursor:pointer;
text-align:center;
}
.selected{outline:4px solid yellow;}

.Germany{background:#666;}
.France{background:#2f5eff;}
.USSR{background:#c0392b;}
.UK{background:#8e44ad;}
.Spain{background:#e67e22;}
.Italy{background:#16a085;}
.Poland{background:white;color:black;}
.Yugoslavia{background:#27ae60;}
.Romania{background:#f1c40f;color:black;}
.Sweden{background:#2980b9;}
.Finland{background:#95a5a6;color:black;}
</style>
</head>
<body>

<div id="ui">
<input id="countryInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É">
<button onclick="startGame()">–ù–∞—á–∞—Ç—å</button>
<button onclick="mode='inspect'">–ü–ª–∏—Ç–∫–∞</button>
<button onclick="mode='build'">–ó–∞–≤–æ–¥</button>
<button onclick="mode='deploy'">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å</button>
<button onclick="mode='attack'">–ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
<button onclick="mode='tankFactory'">–ó–∞–≤–æ–¥ —Ç–∞–Ω–∫–æ–≤</button>
<button onclick="makePeace()">–ú–∏—Ä</button>
<div id="money">üí∞ 0</div>
<div id="reserve">ü™ñ 0</div>
<div id="tankReserve">üöì 0</div>
</div>

<div id="map-wrapper"><div id="map"></div></div>

<script>

let mode=null,playerCountry=null,money=0,reserve=0,tankReserve=0,selectedTile=null;
const tiles=[];
const wars={};
const map=document.getElementById("map");

const capitals={
Germany:'Berlin',France:'Paris',USSR:'Moscow',UK:'London',
Spain:'Madrid',Italy:'Rome',Romania:'Bucharest',
Yugoslavia:'Belgrade',AustriaHungary:'Vienna',
Finland:'Helsinki',Sweden:'Stockholm',Poland:'Warsaw'
};

function updateUI(){
document.getElementById("money").innerText="üí∞ "+money;
document.getElementById("reserve").innerText="ü™ñ "+reserve;
document.getElementById("tankReserve").innerText="üöì "+Math.floor(tankReserve);
}

function addTile(name,country,x,y){
let t={
name,country,x,y,
army:0,tanks:0,
factories:0,
maxFactories: country===playerCountry?2:1,
tankFactory:false,
tankTimer:0
};
tiles.push(t);

let el=document.createElement("div");
el.className="tile "+country;
el.style.left=x+"px";
el.style.top=y+"px";
el.onclick=()=>tileClick(t,el);
t.el=el;
map.appendChild(el);
updateTile(t);
}

function updateTile(t){
t.el.innerHTML=`<b>${t.name}</b>
<div>ü™ñ ${t.army}</div>
<div>üöì ${t.tanks}</div>
<div>üè≠ ${t.factories}/${t.maxFactories}${t.tankFactory?' üèó':' '}</div>`;
}

function tileClick(t,el){

document.querySelectorAll('.tile').forEach(e=>e.classList.remove('selected'));
el.classList.add('selected');

if(mode==='inspect'){
alert(`–ì–æ—Ä–æ–¥: ${t.name}
–°—Ç—Ä–∞–Ω–∞: ${t.country}
–°–æ–ª–¥–∞—Ç—ã: ${t.army}
–¢–∞–Ω–∫–∏: ${t.tanks}
–ó–∞–≤–æ–¥—ã: ${t.factories}/${t.maxFactories}
–¢–∞–Ω–∫–æ–≤—ã–π –∑–∞–≤–æ–¥: ${t.tankFactory?'–ï—Å—Ç—å':'–ù–µ—Ç'}`);
}

if(mode==='build' && t.country===playerCountry){
if(t.factories<t.maxFactories && money>=5000){
money-=5000;
t.factories++;
}
}

if(mode==='tankFactory'){
if(capitals[t.country]===t.name && !t.tankFactory && money>=25000){
money-=25000;
t.tankFactory=true;
t.tankTimer=0;
}
}

if(mode==='deploy' && t.country===playerCountry){
let type=prompt("1-—Å–æ–ª–¥–∞—Ç—ã 2-—Ç–∞–Ω–∫–∏");
let n=parseInt(prompt("–°–∫–æ–ª—å–∫–æ?"));
if((type==='1' || type==='soldiers') && n<=reserve){ reserve-=n; t.army+=n; }
if((type==='2' || type==='tanks') && n<=Math.floor(tankReserve)){ tankReserve-=n; t.tanks+=n; }
}

if(mode==='attack' && selectedTile && selectedTile!==t){
attack(selectedTile,t);
}

selectedTile=t;
updateTile(t);
updateUI();
}

function attack(from,to){
let type=prompt("1-—Å–æ–ª–¥–∞—Ç—ã 2-—Ç–∞–Ω–∫–∏");
let n=parseInt(prompt("–°–∫–æ–ª—å–∫–æ?"));

if(to.country!==playerCountry) wars[to.country]=true;

// –¢–∞–Ω–∫–∏
if((type==='2' || type==='tanks') && from.tanks>=n){
from.tanks-=n;
let power=n*100;
if(power>=to.army){
let old=to.country;
to.country=playerCountry;
to.army=0;
to.tanks=0;
to.el.className='tile '+playerCountry;
to.factories=0;
to.maxFactories=2;
if(capitals[old]===to.name){ capitulate(old); }
}else{
to.army-=power;
}
}

// –°–æ–ª–¥–∞—Ç—ã
if((type==='1' || type==='soldiers') && from.army>=n){
from.army-=n;
if(n>=to.army){
to.country=playerCountry;
to.army=n-to.army;
to.tanks=0;
to.el.className='tile '+playerCountry;
to.factories=0;
to.maxFactories=2;
}else{
to.army-=n;
}
}

updateTile(from);
updateTile(to);
}

function capitulate(country){
tiles.forEach(t=>{
if(t.country===country){
t.country=playerCountry;
t.el.className='tile '+playerCountry;
t.army=0;
t.tanks=0;
t.factories=0;
t.maxFactories=2;
}
});
delete wars[country];
alert(country+" –∫–∞–ø–∏—Ç—É–ª–∏—Ä–æ–≤–∞–ª–∞!");
}

function makePeace(){
for(let c in wars) delete wars[c];
alert("–ú–∏—Ä –∑–∞–∫–ª—é—á–µ–Ω");
}

function startGame(){
playerCountry=document.getElementById("countryInput").value.trim();
money=500; reserve=0; tankReserve=0;

tiles.forEach(t=>{
if(t.country===playerCountry){
t.factories=0; t.maxFactories=2; t.army=0; t.tanks=0; t.tankFactory=false;
}else{
t.factories=1; t.maxFactories=1; t.army=0; t.tanks=0; t.tankFactory=false;
}
updateTile(t);
});
updateUI();
}

// ===== –ü–†–û–ò–ó–í–û–î–°–¢–í–û =====
setInterval(()=>{
tiles.forEach(t=>{
if(t.country===playerCountry){
money+=15;
if(t.factories>0) reserve+=t.factories;
}else{
t.army+=1;
}
if(t.tankFactory){
t.tankTimer++;
if(t.tankTimer>=10){ t.tanks++; t.tankTimer=0; }
}
updateTile(t);
});
updateUI();
},1000);

// ===== –ë–û–¢ –ê–¢–ê–ö–ê –í–°–ï–ú–ò –°–ò–õ–ê–ú–ò =====
setInterval(()=>{
for(let enemy in wars){
let enemyTiles=tiles.filter(t=>t.country===enemy);
let playerTiles=tiles.filter(t=>t.country===playerCountry);
enemyTiles.forEach(et=>{
if(et.army>0 && playerTiles.length>0){
let target=playerTiles[Math.floor(Math.random()*playerTiles.length)];
target.army-=et.army;
if(target.army<0) target.army=0;
et.army=0;
updateTile(target);
updateTile(et);
}
});
}
},3000);

// ===== –ö–ê–†–¢–ê =====

// –ì–µ—Ä–º–∞–Ω–∏—è
addTile('Berlin','Germany',500,200);
addTile('Munich','Germany',500,320);
addTile('Hamburg','Germany',500,120);

// –§—Ä–∞–Ω—Ü–∏—è
addTile('Paris','France',340,250);
addTile('Marseille','France',360,370);

// –ò—Å–ø–∞–Ω–∏—è
addTile('Madrid','Spain',200,380);
addTile('Barcelona','Spain',260,350);

// –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è
addTile('London','UK',200,180);
addTile('Manchester','UK',200,110);

// –ò—Ç–∞–ª–∏—è
addTile('Rome','Italy',460,420);
addTile('Sicily','Italy',480,520);

// –ü–æ–ª—å—à–∞
addTile('Warsaw','Poland',620,260);
addTile('Krakow','Poland',620,330);

// –Æ–≥–æ—Å–ª–∞–≤–∏—è
addTile('Belgrade','Yugoslavia',560,380);
addTile('Zagreb','Yugoslavia',520,360);
addTile('Sarajevo','Yugoslavia',580,420);

// –°–°–°–†
addTile('Moscow','USSR',760,200);
addTile('Leningrad','USSR',760,120);
addTile('Kiev','USSR',700,300);
addTile('Minsk','USSR',700,220);

// –†—É–º—ã–Ω–∏—è
addTile('Bucharest','Romania',680,400);
addTile('Cluj-Napoca','Romania',650,350);

// –®–≤–µ—Ü–∏—è
addTile('Stockholm','Sweden',700,60);

// –§–∏–Ω–ª—è–Ω–¥–∏—è
addTile('Helsinki','Finland',760,60);

</script>
</body>
</html>
