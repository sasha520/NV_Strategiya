<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>NV_Strategy</title>
<style>
body{margin:0;background:#1b1b1b;color:white;font-family:Arial;}
#ui{
  position:fixed;top:0;left:0;width:100%;
  background:#111;padding:8px;
  display:flex;gap:6px;align-items:center;z-index:10;
}
button,input{background:#333;color:white;border:1px solid #666;padding:5px 10px;}
#map-wrapper{
  position:absolute;top:50px;left:0;right:0;bottom:0;
  overflow:auto;background:#2c3e50;
}
#map{position:relative;width:1400px;height:900px;}
.tile{
  position:absolute;width:85px;height:85px;
  border-radius:8px;border:2px solid black;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  font-size:11px;cursor:pointer;text-align:center;
}
.selected{outline:4px solid yellow;}
.Germany{background:#666;}
.France{background:#2f5eff;}
.USSR{background:#c0392b;}
.AustriaHungary{background:#aaa;color:black;}
.Romania{background:#f1c40f;color:black;}
.Yugoslavia{background:#27ae60;}
.UK{background:#8e44ad;}
.Spain{background:#e67e22;}
.Italy{background:#16a085;}
.Finland{background:#95a5a6;color:black;}
.Sweden{background:#2980b9;}
.Poland{background:#d35400;}
</style>
</head>
<body>

<div id="ui">
<input id="countryInput" placeholder="–°—Ç—Ä–∞–Ω–∞">
<button onclick="startGame()">–ù–∞—á–∞—Ç—å</button>
<button onclick="mode='inspect'">–ü–ª–∏—Ç–∫–∞</button>
<button onclick="mode='build'">–ó–∞–≤–æ–¥</button>
<button onclick="mode='tankFactory'">–ó–∞–≤–æ–¥ —Ç–∞–Ω–∫–æ–≤</button>
<button onclick="mode='deploy'">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å</button>
<button onclick="mode='attack'">–ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
<div id="money">üí∞ 0</div>
<div id="reserve">ü™ñ 0</div>
<div id="tankReserve">üöú 0</div>
</div>

<div id="map-wrapper"><div id="map"></div></div>

<script>
let playerCountry=null,mode=null;
let money=0,reserve=0,tankReserve=0;
let selectedTile=null;
const map=document.getElementById("map");
const tiles=[];

const capitals={
 Germany:'Berlin',France:'Paris',USSR:'Moscow',UK:'London',
 Spain:'Madrid',Italy:'Rome',Romania:'Bucharest',
 Yugoslavia:'Belgrade',AustriaHungary:'Vienna',
 Finland:'Helsinki',Sweden:'Stockholm',Poland:'Warsaw'
};

const moneyEl=document.getElementById("money");
const reserveEl=document.getElementById("reserve");
const tankReserveEl=document.getElementById("tankReserve");

function updateUI(){
 moneyEl.innerText="üí∞ "+money;
 reserveEl.innerText="ü™ñ "+reserve;
 tankReserveEl.innerText="üöú "+Math.floor(tankReserve);
}

function addTile(name,country,x,y){
 const t={
  name,country,
  army:0,tanks:0,
  factories:1,maxFactories:1,
  tankFactory:false
 };
 const el=document.createElement("div");
 el.className="tile "+country;
 el.style.left=x+"px";
 el.style.top=y+"px";
 el.onclick=()=>onTileClick(t,el);
 t.el=el;
 tiles.push(t);
 map.appendChild(el);
 drawTile(t);
}

function drawTile(t){
 t.el.innerHTML=`<b>${t.name}</b>
 <div>ü™ñ ${Math.floor(t.army)}</div>
 <div>üöú ${Math.floor(t.tanks)}</div>`;
}

function onTileClick(t,el){
 document.querySelectorAll('.tile').forEach(e=>e.classList.remove('selected'));
 el.classList.add('selected');

 if(mode==='inspect'){
  alert(
   `–ì–æ—Ä–æ–¥: ${t.name}\n`+
   `–°—Ç—Ä–∞–Ω–∞: ${t.country}\n`+
   `–ó–∞–≤–æ–¥—ã: ${t.factories}/${t.maxFactories}\n`+
   `–¢–∞–Ω–∫–æ–≤—ã–π –∑–∞–≤–æ–¥: ${t.tankFactory ? '–î–∞' : '–ù–µ—Ç'}`
  );
 }

 if(mode==='build' && t.country===playerCountry){
  if(t.factories<t.maxFactories && money>=5000){
   money-=5000;t.factories++;
  }
 }

 if(mode==='tankFactory' && t.country===playerCountry){
  if(capitals[t.country]===t.name && !t.tankFactory && money>=25000){
   money-=25000;t.tankFactory=true;
  }
 }

 if(mode==='deploy' && t.country===playerCountry){
  const n=parseInt(prompt("–°–∫–æ–ª—å–∫–æ —Å–æ–ª–¥–∞—Ç?"));
  if(n<=reserve){reserve-=n;t.army+=n;}
 }

 if(mode==='attack' && selectedTile && selectedTile!==t){
  attack(selectedTile,t);
 }

 selectedTile=t;
 drawTile(t);updateUI();
}

function attack(from,to){
 let soldiers=from.army;
 let tanks=from.tanks;
 from.army=0;from.tanks=0;

 if(tanks>0){
  const kill=Math.min(to.army,tanks*100);
  to.army-=kill;
  tanks=0;
 }

 if(soldiers>=to.army){
  soldiers-=to.army;
  to.army=0;
 }else{
  to.army-=soldiers;
  soldiers=0;
 }

 if(to.army===0){
  to.country=playerCountry;
  to.el.className="tile "+playerCountry;
  to.army=soldiers;
  to.factories=0;
  to.maxFactories=2;
 }

 drawTile(from);drawTile(to);
}

function startGame(){
 playerCountry=document.getElementById("countryInput").value.trim();
 money=0;reserve=0;tankReserve=0;

 tiles.forEach(t=>{
  if(t.country===playerCountry){
   t.factories=0;
   t.maxFactories=2;
  }
 });
 updateUI();
}

/* ===== –ü–õ–ò–¢–ö–ò (—Ç–≤–æ–∏ + –Ω–æ–≤—ã–µ) ===== */

// Germany
addTile('Hamburg','Germany',300,150);
addTile('Berlin','Germany',300,250);
addTile('Munich','Germany',300,350);

// France
addTile('Paris','France',200,300);
addTile('Marseille','France',220,400);

// UK
addTile('London','UK',100,250);
addTile('Manchester','UK',100,180);

// Spain
addTile('Madrid','Spain',120,420);
addTile('Barcelona','Spain',170,380);

// Italy
addTile('Venice','Italy',360,350);
addTile('Rome','Italy',340,420);
addTile('Sicily','Italy',360,470);

// USSR
addTile('Leningrad','USSR',520,120);
addTile('Moscow','USSR',520,200);
addTile('Minsk','USSR',480,250);
addTile('Kiev','USSR',480,320);

// Poland
addTile('Warsaw','Poland',400,260);
addTile('Krakow','Poland',400,300);

// Austria-Hungary
addTile('Vienna','AustriaHungary',350,320);
addTile('Budapest','AustriaHungary',390,320);

// Yugoslavia
addTile('Zagreb','Yugoslavia',340,360);
addTile('Belgrade','Yugoslavia',390,380);
addTile('Sarajevo','Yugoslavia',370,420);

// Romania
addTile('Bucharest','Romania',450,360);
addTile('Cluj-Napoca','Romania',420,330);

// Scandinavia
addTile('Stockholm','Sweden',480,150);
addTile('Helsinki','Finland',520,100);

/* ===== –¢–ò–ö ===== */
setInterval(()=>{
 tiles.forEach(t=>{
  if(t.country===playerCountry){
   money+=15;
   reserve+=t.factories;
   if(t.tankFactory) tankReserve+=0.1;
  }else{
   t.army+=t.factories;
   if(t.tankFactory) t.tanks+=0.1;
  }
  drawTile(t);
 });
 updateUI();
},1000);
</script>
</body>
</html>
